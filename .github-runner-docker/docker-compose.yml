# Docker Compose for Self-Hosted GitHub Actions Runner
#
# Usage:
#   1. Copy .env.example to .env and configure
#   2. docker-compose up -d
#   3. docker-compose logs -f (to view logs)
#   4. docker-compose down (to stop and remove runner)
#
# The runner will automatically:
#   - Register with GitHub on startup
#   - Unregister on graceful shutdown

services:
  runner:
    build:
      context: .
      args:
        - RUNNER_VERSION=2.321.0
        - GO_VERSION=1.24.2
        - TERRAFORM_VERSION=1.9.8
    image: f5xc-runner:latest
    container_name: f5xc-github-runner
    restart: unless-stopped
    environment:
      # Required: Repository in owner/repo format
      - GITHUB_REPOSITORY=${GITHUB_REPOSITORY}
      # Required: Personal Access Token with repo scope
      - GITHUB_TOKEN=${GITHUB_TOKEN}
      # Optional: Custom runner name (default: container hostname)
      - RUNNER_NAME=${RUNNER_NAME:-f5xc-container-runner}
      # Optional: Additional labels
      - RUNNER_LABELS=${RUNNER_LABELS:-self-hosted,Linux,X64,container}
      # F5 XC API credentials (passed to workflow jobs)
      - F5XC_API_URL=${F5XC_API_URL:-}
      - F5XC_API_TOKEN=${F5XC_API_TOKEN:-}
    volumes:
      # Persist runner work directory for caching
      - runner-work:/home/runner/actions-runner/_work
      # Optional: Mount Docker socket for Docker-in-Docker workflows
      # - /var/run/docker.sock:/var/run/docker.sock
    # Resource limits (adjust as needed)
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 4G
        reservations:
          cpus: '1'
          memory: 2G

volumes:
  runner-work:
    name: f5xc-runner-work
