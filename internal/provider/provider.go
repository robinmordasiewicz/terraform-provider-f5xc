// Code generated by generate-all-schemas.go. DO NOT EDIT.
// Source: F5 XC OpenAPI specification

package provider

import (
	"context"
	"os"

	"github.com/hashicorp/terraform-plugin-framework/datasource"
	"github.com/hashicorp/terraform-plugin-framework/path"
	"github.com/hashicorp/terraform-plugin-framework/provider"
	"github.com/hashicorp/terraform-plugin-framework/provider/schema"
	"github.com/hashicorp/terraform-plugin-framework/resource"
	"github.com/hashicorp/terraform-plugin-framework/types"
	"github.com/hashicorp/terraform-plugin-log/tflog"

	"github.com/f5xc/terraform-provider-f5xc/internal/client"
)

// Ensure F5XCProvider satisfies various provider interfaces.
var _ provider.Provider = &F5XCProvider{}

// F5XCProvider defines the provider implementation.
type F5XCProvider struct {
	// version is set to the provider version on release, "dev" when the
	// provider is built and ran locally, and "test" when running acceptance
	// testing.
	version string
}

// F5XCProviderModel describes the provider data model.
type F5XCProviderModel struct {
	APIToken    types.String `tfsdk:"api_token"`
	APIURL      types.String `tfsdk:"api_url"`
	APIP12File  types.String `tfsdk:"api_p12_file"`
	P12Password types.String `tfsdk:"p12_password"`
	APICert     types.String `tfsdk:"api_cert"`
	APIKey      types.String `tfsdk:"api_key"`
	APICACert   types.String `tfsdk:"api_ca_cert"`
}

func (p *F5XCProvider) Metadata(ctx context.Context, req provider.MetadataRequest, resp *provider.MetadataResponse) {
	resp.TypeName = "f5xc"
	resp.Version = p.version
}

func (p *F5XCProvider) Schema(ctx context.Context, req provider.SchemaRequest, resp *provider.SchemaResponse) {
	resp.Schema = schema.Schema{
		MarkdownDescription: "Terraform provider for F5 Distributed Cloud (F5XC) enabling infrastructure as code " +
			"for load balancers, security policies, sites, and networking. Community-maintained provider " +
			"built from public F5 API documentation.",
		Attributes: map[string]schema.Attribute{
			"api_url": schema.StringAttribute{
				MarkdownDescription: "F5 Distributed Cloud API URL (base URL without '/api' suffix). " +
					"Defaults to https://console.ves.volterra.io. " +
					"Example: https://tenant.console.ves.volterra.io (NOT https://tenant.console.ves.volterra.io/api). " +
					"Can also be set via VES_API_URL environment variable.",
				Optional: true,
			},
			"api_token": schema.StringAttribute{
				MarkdownDescription: "F5 Distributed Cloud API Token for token-based authentication. " +
					"Can also be set via VES_API_TOKEN environment variable. " +
					"Either api_token or api_p12_file/api_cert must be specified.",
				Optional:  true,
				Sensitive: true,
			},
			"api_p12_file": schema.StringAttribute{
				MarkdownDescription: "Path to PKCS#12 certificate bundle file for certificate-based authentication. " +
					"Can also be set via VES_P12_FILE environment variable. " +
					"When using P12 authentication, p12_password must also be provided.",
				Optional:  true,
				Sensitive: false,
			},
			"p12_password": schema.StringAttribute{
				MarkdownDescription: "Password for the PKCS#12 certificate bundle. " +
					"Can also be set via VES_P12_PASSWORD environment variable.",
				Optional:  true,
				Sensitive: true,
			},
			"api_cert": schema.StringAttribute{
				MarkdownDescription: "Path to PEM-encoded client certificate file for certificate-based authentication. " +
					"Can also be set via VES_CERT environment variable. " +
					"When using certificate authentication, api_key must also be provided.",
				Optional: true,
			},
			"api_key": schema.StringAttribute{
				MarkdownDescription: "Path to PEM-encoded client private key file for certificate-based authentication. " +
					"Can also be set via VES_KEY environment variable.",
				Optional:  true,
				Sensitive: true,
			},
			"api_ca_cert": schema.StringAttribute{
				MarkdownDescription: "Path to PEM-encoded CA certificate file for verifying the F5XC API server. " +
					"Can also be set via VES_CACERT environment variable. Optional.",
				Optional: true,
			},
		},
	}
}

func (p *F5XCProvider) Configure(ctx context.Context, req provider.ConfigureRequest, resp *provider.ConfigureResponse) {
	tflog.Info(ctx, "Configuring F5XC client")

	var config F5XCProviderModel

	resp.Diagnostics.Append(req.Config.Get(ctx, &config)...)

	if resp.Diagnostics.HasError() {
		return
	}

	// Get configuration values from environment variables first
	apiURL := os.Getenv("VES_API_URL")
	apiToken := os.Getenv("VES_API_TOKEN")
	apiP12File := os.Getenv("VES_P12_FILE")
	p12Password := os.Getenv("VES_P12_PASSWORD")
	apiCert := os.Getenv("VES_CERT")
	apiKey := os.Getenv("VES_KEY")
	apiCACert := os.Getenv("VES_CACERT")

	// Configuration values override environment variables
	if !config.APIURL.IsNull() {
		apiURL = config.APIURL.ValueString()
	}
	if !config.APIToken.IsNull() {
		apiToken = config.APIToken.ValueString()
	}
	if !config.APIP12File.IsNull() {
		apiP12File = config.APIP12File.ValueString()
	}
	if !config.P12Password.IsNull() {
		p12Password = config.P12Password.ValueString()
	}
	if !config.APICert.IsNull() {
		apiCert = config.APICert.ValueString()
	}
	if !config.APIKey.IsNull() {
		apiKey = config.APIKey.ValueString()
	}
	if !config.APICACert.IsNull() {
		apiCACert = config.APICACert.ValueString()
	}

	// Set default API URL if not provided
	if apiURL == "" {
		apiURL = "https://console.ves.volterra.io/api"
	}

	var c *client.Client
	var err error

	// Determine authentication method
	switch {
	case apiP12File != "":
		// P12 certificate authentication
		if p12Password == "" {
			resp.Diagnostics.AddAttributeError(
				path.Root("p12_password"),
				"Missing P12 Password",
				"When using P12 certificate authentication (api_p12_file), the p12_password must be provided. "+
					"Set the p12_password value in the configuration or use the VES_P12_PASSWORD environment variable.",
			)
			return
		}
		c, err = client.NewClientWithP12(apiURL, apiP12File, p12Password)
		if err != nil {
			resp.Diagnostics.AddError(
				"Failed to Create F5XC Client",
				"Could not create F5XC client with P12 certificate: "+err.Error(),
			)
			return
		}
		tflog.Info(ctx, "Configured F5XC client with P12 certificate authentication", map[string]any{"success": true, "api_url": apiURL})

	case apiCert != "" && apiKey != "":
		// PEM certificate/key authentication
		c, err = client.NewClientWithCert(apiURL, apiCert, apiKey, apiCACert)
		if err != nil {
			resp.Diagnostics.AddError(
				"Failed to Create F5XC Client",
				"Could not create F5XC client with certificate: "+err.Error(),
			)
			return
		}
		tflog.Info(ctx, "Configured F5XC client with certificate authentication", map[string]any{"success": true, "api_url": apiURL})

	case apiToken != "":
		// API token authentication
		c = client.NewClient(apiURL, apiToken)
		tflog.Info(ctx, "Configured F5XC client with API token authentication", map[string]any{"success": true, "api_url": apiURL})

	default:
		resp.Diagnostics.AddError(
			"Missing Authentication Configuration",
			"The provider requires authentication. Please configure one of the following:\n"+
				"  - api_token (or VES_API_TOKEN environment variable) for API token authentication\n"+
				"  - api_p12_file and p12_password (or VES_P12_FILE and VES_P12_PASSWORD environment variables) for P12 certificate authentication\n"+
				"  - api_cert and api_key (or VES_CERT and VES_KEY environment variables) for PEM certificate authentication",
		)
		return
	}

	// Make the client available during DataSource and Resource type Configure methods
	resp.DataSourceData = c
	resp.ResourceData = c
}

func (p *F5XCProvider) Resources(ctx context.Context) []func() resource.Resource {
	return []func() resource.Resource{
		NewAPICrawlerResource,
		NewAPICredentialResource,
		NewAPIDefinitionResource,
		NewAPIDiscoveryResource,
		NewAPITestingResource,
		NewAPMResource,
		NewAWSTGWSiteResource,
		NewAWSVPCSiteResource,
		NewAddonSubscriptionResource,
		NewAddressAllocatorResource,
		NewAdvertisePolicyResource,
		NewAlertPolicyResource,
		NewAlertReceiverResource,
		NewAllowedTenantResource,
		NewAppAPIGroupResource,
		NewAppFirewallResource,
		NewAppSettingResource,
		NewAppTypeResource,
		NewAuthenticationResource,
		NewAzureVNETSiteResource,
		NewBGPAsnSetResource,
		NewBGPResource,
		NewBGPRoutingPolicyResource,
		NewBigIPIruleResource,
		NewBotDefenseAppInfrastructureResource,
		NewCDNCacheRuleResource,
		NewCDNLoadBalancerResource,
		NewCRLResource,
		NewCertificateChainResource,
		NewCertificateResource,
		NewChildTenantManagerResource,
		NewChildTenantResource,
		NewCloudConnectResource,
		NewCloudCredentialsResource,
		NewCloudElasticIPResource,
		NewCloudLinkResource,
		NewClusterResource,
		NewCminstanceResource,
		NewCodeBaseIntegrationResource,
		NewContactResource,
		NewContainerRegistryResource,
		NewCustomerSupportResource,
		NewDNSComplianceChecksResource,
		NewDNSDomainResource,
		NewDNSLBHealthCheckResource,
		NewDNSLBPoolResource,
		NewDNSLoadBalancerResource,
		NewDNSZoneResource,
		NewDataGroupResource,
		NewDataTypeResource,
		NewDcClusterGroupResource,
		NewDiscoveryResource,
		NewEndpointResource,
		NewEnhancedFirewallPolicyResource,
		NewExternalConnectorResource,
		NewFastACLResource,
		NewFastACLRuleResource,
		NewFilterSetResource,
		NewFleetResource,
		NewForwardProxyPolicyResource,
		NewForwardingClassResource,
		NewGCPVPCSiteResource,
		NewGeoLocationSetResource,
		NewGlobalLogReceiverResource,
		NewHTTPLoadBalancerResource,
		NewHealthcheckResource,
		NewIKEPhase1ProfileResource,
		NewIKEPhase2ProfileResource,
		NewIPPrefixSetResource,
		NewIke1Resource,
		NewIke2Resource,
		NewInfraprotectAsnPrefixResource,
		NewInfraprotectAsnResource,
		NewInfraprotectDenyListRuleResource,
		NewInfraprotectFirewallRuleGroupResource,
		NewInfraprotectFirewallRuleResource,
		NewInfraprotectInternetPrefixAdvertisementResource,
		NewInfraprotectTunnelResource,
		NewIruleResource,
		NewK8SClusterResource,
		NewK8SClusterRoleBindingResource,
		NewK8SClusterRoleResource,
		NewK8SPodSecurityAdmissionResource,
		NewK8SPodSecurityPolicyResource,
		NewLogReceiverResource,
		NewMaliciousUserMitigationResource,
		NewManagedTenantResource,
		NewNATPolicyResource,
		NewNamespaceResource,
		NewNetworkConnectorResource,
		NewNetworkFirewallResource,
		NewNetworkInterfaceResource,
		NewNetworkPolicyResource,
		NewNetworkPolicyRuleResource,
		NewNetworkPolicyViewResource,
		NewNfvServiceResource,
		NewOIDCProviderResource,
		NewOriginPoolResource,
		NewPolicerResource,
		NewPolicyBasedRoutingResource,
		NewProtocolInspectionResource,
		NewProtocolPolicerResource,
		NewProxyResource,
		NewQuotaResource,
		NewRateLimiterPolicyResource,
		NewRateLimiterResource,
		NewRegistrationResource,
		NewReportConfigResource,
		NewRoleResource,
		NewRouteResource,
		NewSecretManagementAccessResource,
		NewSecretPolicyResource,
		NewSecretPolicyRuleResource,
		NewSecuremeshSiteResource,
		NewSecuremeshSiteV2Resource,
		NewSegmentResource,
		NewSensitiveDataPolicyResource,
		NewServicePolicyResource,
		NewServicePolicyRuleResource,
		NewSiteMeshGroupResource,
		NewSrv6NetworkSliceResource,
		NewSubnetResource,
		NewTCPLoadBalancerResource,
		NewTenantConfigurationResource,
		NewTenantProfileResource,
		NewTicketTrackingSystemResource,
		NewTokenResource,
		NewTpmAPIKeyResource,
		NewTpmCategoryResource,
		NewTpmManagerResource,
		NewTrustedCAListResource,
		NewTunnelResource,
		NewUDPLoadBalancerResource,
		NewUsbPolicyResource,
		NewUserIdentificationResource,
		NewVirtualHostResource,
		NewVirtualK8SResource,
		NewVirtualNetworkResource,
		NewVirtualSiteResource,
		NewVoltshareAdminPolicyResource,
		NewVoltstackSiteResource,
		NewWAFExclusionPolicyResource,
		NewWorkloadFlavorResource,
		NewWorkloadResource,
	}
}

func (p *F5XCProvider) DataSources(ctx context.Context) []func() datasource.DataSource {
	return []func() datasource.DataSource{
		NewAPICrawlerDataSource,
		NewAPICredentialDataSource,
		NewAPIDefinitionDataSource,
		NewAPIDiscoveryDataSource,
		NewAPITestingDataSource,
		NewAPMDataSource,
		NewAWSTGWSiteDataSource,
		NewAWSVPCSiteDataSource,
		NewAddonSubscriptionDataSource,
		NewAddressAllocatorDataSource,
		NewAdvertisePolicyDataSource,
		NewAlertPolicyDataSource,
		NewAlertReceiverDataSource,
		NewAllowedTenantDataSource,
		NewAppAPIGroupDataSource,
		NewAppFirewallDataSource,
		NewAppSettingDataSource,
		NewAppTypeDataSource,
		NewAuthenticationDataSource,
		NewAzureVNETSiteDataSource,
		NewBGPAsnSetDataSource,
		NewBGPDataSource,
		NewBGPRoutingPolicyDataSource,
		NewBigIPIruleDataSource,
		NewBotDefenseAppInfrastructureDataSource,
		NewCDNCacheRuleDataSource,
		NewCDNLoadBalancerDataSource,
		NewCRLDataSource,
		NewCertificateChainDataSource,
		NewCertificateDataSource,
		NewChildTenantDataSource,
		NewChildTenantManagerDataSource,
		NewCloudConnectDataSource,
		NewCloudCredentialsDataSource,
		NewCloudElasticIPDataSource,
		NewCloudLinkDataSource,
		NewClusterDataSource,
		NewCminstanceDataSource,
		NewCodeBaseIntegrationDataSource,
		NewContactDataSource,
		NewContainerRegistryDataSource,
		NewCustomerSupportDataSource,
		NewDNSComplianceChecksDataSource,
		NewDNSDomainDataSource,
		NewDNSLBHealthCheckDataSource,
		NewDNSLBPoolDataSource,
		NewDNSLoadBalancerDataSource,
		NewDNSZoneDataSource,
		NewDataGroupDataSource,
		NewDataTypeDataSource,
		NewDcClusterGroupDataSource,
		NewDiscoveryDataSource,
		NewEndpointDataSource,
		NewEnhancedFirewallPolicyDataSource,
		NewExternalConnectorDataSource,
		NewFastACLDataSource,
		NewFastACLRuleDataSource,
		NewFilterSetDataSource,
		NewFleetDataSource,
		NewForwardProxyPolicyDataSource,
		NewForwardingClassDataSource,
		NewGCPVPCSiteDataSource,
		NewGeoLocationSetDataSource,
		NewGlobalLogReceiverDataSource,
		NewHTTPLoadBalancerDataSource,
		NewHealthcheckDataSource,
		NewIKEPhase1ProfileDataSource,
		NewIKEPhase2ProfileDataSource,
		NewIPPrefixSetDataSource,
		NewIke1DataSource,
		NewIke2DataSource,
		NewInfraprotectAsnDataSource,
		NewInfraprotectAsnPrefixDataSource,
		NewInfraprotectDenyListRuleDataSource,
		NewInfraprotectFirewallRuleDataSource,
		NewInfraprotectFirewallRuleGroupDataSource,
		NewInfraprotectInternetPrefixAdvertisementDataSource,
		NewInfraprotectTunnelDataSource,
		NewIruleDataSource,
		NewK8SClusterDataSource,
		NewK8SClusterRoleBindingDataSource,
		NewK8SClusterRoleDataSource,
		NewK8SPodSecurityAdmissionDataSource,
		NewK8SPodSecurityPolicyDataSource,
		NewLogReceiverDataSource,
		NewMaliciousUserMitigationDataSource,
		NewManagedTenantDataSource,
		NewNATPolicyDataSource,
		NewNamespaceDataSource,
		NewNetworkConnectorDataSource,
		NewNetworkFirewallDataSource,
		NewNetworkInterfaceDataSource,
		NewNetworkPolicyDataSource,
		NewNetworkPolicyRuleDataSource,
		NewNetworkPolicyViewDataSource,
		NewNfvServiceDataSource,
		NewOIDCProviderDataSource,
		NewOriginPoolDataSource,
		NewPolicerDataSource,
		NewPolicyBasedRoutingDataSource,
		NewProtocolInspectionDataSource,
		NewProtocolPolicerDataSource,
		NewProxyDataSource,
		NewQuotaDataSource,
		NewRateLimiterDataSource,
		NewRateLimiterPolicyDataSource,
		NewRegistrationDataSource,
		NewReportConfigDataSource,
		NewRoleDataSource,
		NewRouteDataSource,
		NewSecretManagementAccessDataSource,
		NewSecretPolicyDataSource,
		NewSecretPolicyRuleDataSource,
		NewSecuremeshSiteDataSource,
		NewSecuremeshSiteV2DataSource,
		NewSegmentDataSource,
		NewSensitiveDataPolicyDataSource,
		NewServicePolicyDataSource,
		NewServicePolicyRuleDataSource,
		NewSiteMeshGroupDataSource,
		NewSrv6NetworkSliceDataSource,
		NewSubnetDataSource,
		NewTCPLoadBalancerDataSource,
		NewTenantConfigurationDataSource,
		NewTenantProfileDataSource,
		NewTicketTrackingSystemDataSource,
		NewTokenDataSource,
		NewTpmAPIKeyDataSource,
		NewTpmCategoryDataSource,
		NewTpmManagerDataSource,
		NewTrustedCAListDataSource,
		NewTunnelDataSource,
		NewUDPLoadBalancerDataSource,
		NewUsbPolicyDataSource,
		NewUserIdentificationDataSource,
		NewVirtualHostDataSource,
		NewVirtualK8SDataSource,
		NewVirtualNetworkDataSource,
		NewVirtualSiteDataSource,
		NewVoltshareAdminPolicyDataSource,
		NewVoltstackSiteDataSource,
		NewWAFExclusionPolicyDataSource,
		NewWorkloadDataSource,
		NewWorkloadFlavorDataSource,
	}
}

func New(version string) func() provider.Provider {
	return func() provider.Provider {
		return &F5XCProvider{
			version: version,
		}
	}
}
